<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta
      name="description"
      content="A demonstration of the waiter-js library, a simple module for handling requests among apps on the browser."
    />
    <meta name="keywords" content="waiter-js, javascript, library, requests, browser, communication, frontend"/>
    <meta name="author" content="strange-bytes"/>
    <meta name="theme-color" content="#121212"/>
    <meta name="homepage" content="https://www.npmjs.com/package/@strange-bytes/waiter"/>
    <meta name="robots" content="index, follow"/>
    <title>Waiter Demo</title>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-N8WVQFKTP3"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-N8WVQFKTP3');
    </script>
    <style>
        body {
            background-color: #121212;
            color: #ffffff;
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }

        .app-container {
            display: flex;
            gap: 20px;
        }

        .app {
            background-color: #1e1e1e;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 20px;
            width: 300px;
            text-align: center;
        }

        .logs {
            background-color: #2d2d2d;
            border: 1px solid #444;
            border-radius: 4px;
            padding: 10px;
            margin: 15px 0;
            text-align: left;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #e0e0e0;
            white-space: pre-wrap;
            word-wrap: break-word;
            min-height: 60px;
            max-height: 150px;
            overflow-y: auto;
        }

        h2 {
            color: #bb86fc;
        }

        button {
            background-color: #03dac6;
            color: #000000;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin: 10px 5px 0;
        }

        button:hover {
            opacity: 0.9;
        }

        button.setup {
            background-color: #6f42c1;
            color: #ffffff;
            font-size: 16px;
            padding: 12px 24px;
            font-weight: bold;
        }
    </style>
</head>
<body>
<a
  href="https://www.npmjs.com/package/@strange-bytes/waiter"
  target="_blank"
  style="text-decoration: none; color: inherit"
>
      <pre align="center" style="color: lightblue; margin-top: 20px">
 __     __     ______     __     ______   ______     ______
/\ \  _ \ \   /\  __ \   /\ \   /\__  _\ /\  ___\   /\  == \
\ \ \/ ".\ \  \ \  __ \  \ \ \  \/_/\ \/ \ \  __\   \ \  __<
   \ \__/".~\_\  \ \_\ \_\  \ \_\    \ \_\  \ \_____\  \ \_\ \_\
    \/_/   \/_/   \/_/\/_/   \/_/     \/_/   \/_____/   \/_/ /_/


<small><b>A simple module that enables you to perform and handle<br>requests among your apps on the browser.</b></small>


</pre>
</a>

<div class="app-container">
    <div class="app" id="rohan">
        <h2>Rohan</h2>
        <pre class="logs" id="rohan-data">No data received yet...</pre>
        <button id="rohan-send">Send message to Gondor</button>
    </div>
    <div class="app" id="gondor">
        <h2>Gondor</h2>
        <pre class="logs" id="gondor-data">No data received yet...</pre>
        <button id="gondor-send">Send message to Rohan</button>
    </div>
</div>

<script type="module">
    import Waiter from '/waiter.mjs';

    let waiter = null;
    let authorizationToken = 'rohan-gondor-auth-2024';

    const rohanData = document.getElementById('rohan-data');
    const gondorData = document.getElementById('gondor-data');

    function getTimestamp() {
        return new Date().toLocaleTimeString();
    }

    function logToApp(element, message) {
        const timestamp = getTimestamp();
        const logEntry = `[${timestamp}] ${message}`;

        if (element.textContent === 'No data received yet...') {
            element.textContent = logEntry;
        } else {
            element.textContent += '\n' + logEntry;
        }

        element.scrollTop = element.scrollHeight;
    }

    function initializeWaiter() {
        waiter = new Waiter({token: authorizationToken});
        setupControllers();
    }

    function setupControllers() {
        waiter.createController(
          'messageForGondor',
          (payload) => {
              logToApp(gondorData, `Message from Rohan: "${payload}"`);
              const resp = 'This day we fight!';
              logToApp(gondorData, `Response to Rohan: "${resp}"`);
              return resp;
          },
          authorizationToken
        );

        waiter.createController(
          'messageForRohan',
          (payload) => {
              logToApp(rohanData, `Message from Gondor: "${payload}"`);
              const resp = 'And Rohan will answer!';
              logToApp(rohanData, `Response to Gondor: "${resp}"`);
              return resp;
          },
          authorizationToken
        );
    }

    initializeWaiter();

    const rohanButton = document.getElementById('rohan-send');
    rohanButton.addEventListener('click', async () => {
        try {
            const requestMessage = 'Ride now! Ride now! Ride! Ride for ruin and the world\'s ending!';
            logToApp(rohanData, `Sending message to Gondor: "${requestMessage}"`);
            const response = await waiter.request('messageForGondor', requestMessage);
            logToApp(rohanData, `Response from Gondor: "${response}"`);
        } catch (error) {
            console.error(error);
            logToApp(rohanData, 'Error: Gondor is not responding!');
        }
    });

    const gondorButton = document.getElementById('gondor-send');
    gondorButton.addEventListener('click', async () => {
        try {
            const requestMessage = 'Gondor calls for aid!';
            logToApp(gondorData, `Sending message to Rohan: "${requestMessage}"`);
            const response = await waiter.request('messageForRohan', requestMessage);
            logToApp(gondorData, `Response from Rohan: "${response}"`);
        } catch (error) {
            console.error(error);
            logToApp(gondorData, 'Error: Rohan is not responding!');
        }
    });
</script>
</body>
</html>